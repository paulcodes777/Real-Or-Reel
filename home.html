<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real or Reel</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header class="top-bar">
    <div class="nav-left">
        <div class="logo">
            RealorReel <span class="emoji">üé£</span>
        </div>
    </div>
    <div class="nav-center"></div>
    <div class="nav-right">
        <a class="about" href="about.html">About</a>
        <a class="help" href="help.html">Help</a>
        <div class="dropdown">
            <a href="#" class="dropbtn">Options ‚ñæ</a>
            <div class="dropdown-content">
                <button id="darkModeBtn">Dark Mode</button>
                <a href="apikey.html">API Key</a>
            </div>
        </div>
        <button class="hamburger" id="hamburgerBtn">&#9776;</button>
    </div>
</header>

<div class="mobile-menu" id="mobileMenu">
    <a href="about.html">About</a>
    <a href="help.html">Help</a>
    <div class="dropdown mobile-dropdown">
        <a href="#" class="dropbtn">Options ‚ñæ</a>
        <div class="dropdown-content">
            <button id="mobileDarkModeBtn">Dark Mode</button>
            <a href="apikey.html">API Key</a>
        </div>
    </div>
</div>

<!-- Search Section -->
<section class="search-section">
    <div class="typing-text" id="typing-text"></div>

    <form id="urlForm" class="search-bar">
        <input type="search" placeholder="Paste URL here..." id="urlInput" class="search-input" required>
        <button type="submit" class="search-button">Check URL</button>
    </form>

    <div id="resultBox" class="result-box"></div>
</section>

<!-- Dark Mode Script -->
<script>
const darkModeBtn = document.getElementById('darkModeBtn');
const mobileDarkModeBtn = document.getElementById('mobileDarkModeBtn');

function updateDarkModeText(btn) {
    btn.textContent = document.body.classList.contains('dark-mode') ? 'Light Mode' : 'Dark Mode';
}

darkModeBtn.addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
    updateDarkModeText(darkModeBtn);
    updateDarkModeText(mobileDarkModeBtn);
});

mobileDarkModeBtn.addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
    updateDarkModeText(darkModeBtn);
    updateDarkModeText(mobileDarkModeBtn);
});
</script>

<!-- Typing Animation -->
<script>
const text = "Drop a URL, catch the results.";
const typingElement = document.getElementById('typing-text');
const typingSpeed = 100;
const delayBetweenLoops = 2000;

function typeLoop() {
    typingElement.textContent = "";
    let index = 0;
    function type() {
        if (index < text.length) {
            typingElement.textContent += text.charAt(index);
            index++;
            setTimeout(type, typingSpeed);
        } else {
            setTimeout(typeLoop, delayBetweenLoops);
        }
    }
    type();
}
window.addEventListener('load', typeLoop);
</script>

<!-- Mobile Menu -->
<script>
const burger = document.getElementById("hamburgerBtn");
const mobileMenu = document.getElementById("mobileMenu");

burger.addEventListener("click", () => {
    mobileMenu.classList.toggle("open");
});
</script>

<!-- SUPER ADVANCED URL ANALYZER (FINAL CONSOLIDATED ENGINE) -->
<script>

/* ----------------------------
   Utility Functions
----------------------------- */

// Levenshtein distance (typosquatting detection)
function levenshtein(a, b) {
    const dp = Array.from({ length: b.length + 1 }, (_, i) => [i]);
    for (let j = 1; j <= a.length; j++) dp[0][j] = j;
    for (let i = 1; i <= b.length; i++) {
        for (let j = 1; j <= a.length; j++) {
            dp[i][j] = Math.min(
                dp[i - 1][j] + 1,
                dp[i][j - 1] + 1,
                dp[i - 1][j - 1] + (a[j - 1] === b[i - 1] ? 0 : 1)
            );
        }
    }
    return dp[b.length][a.length];
}

// Homoglyph (Cyrillic/Greek)
function hasHomoglyphs(str) {
    return /[\u0400-\u04FF\u0370-\u03FF]/.test(str);
}

// Encoded redirect (hex or base64)
function looksEncoded(str) {
    return /^[A-Za-z0-9+/]{12,}={0,2}$/.test(str) || /^[0-9A-F]{16,}$/i.test(str);
}

/* ----------------------------
   Scam Patterns & Data Sets
----------------------------- */

const phishingClusters = [
    ["login", "verify"], ["secure", "update"], ["account", "verify"],
    ["security", "alert"], ["action", "required"], ["package", "held"],
    ["delivery", "confirm"], ["account", "locked"], ["review", "appeal"],
    ["billing", "payment"]
];

const highRiskBrands = [
    "bankofamerica", "boa", "chase", "wellsfargo",
    "instagram", "facebook", "meta", "apple", "appleid",
    "icloud", "outlook", "hotmail",
    "fedex", "ups", "usps", "dhl"
];

const autoUnsafeTLDs = [
    ".fake", ".invalid", ".test", ".support", ".support-login",
    ".co-login", ".security-check", ".verify-user", ".user-update"
];

/* ----------------------------
   Main Analyzer
----------------------------- */

function analyzeURL(inputUrl) {
    let url = inputUrl.trim();
    let lower = url.toLowerCase();
    let risk = 0;
    let findings = [];

    let clean = lower.replace(/^https?:\/\//, "").replace(/^www\./, "");
    let host = clean.split(/[/?#]/)[0];

    // Auto-unsafe TLDs
    autoUnsafeTLDs.forEach(tld => {
        if (host.includes(tld)) {
            risk += 90;
            findings.push(`Domain uses high-risk TLD '${tld}'.`);
        }
    });

    // Hyphen overload
    let hyphenCount = (host.match(/-/g) || []).length;
    if (hyphenCount >= 4) {
        risk += 40;
        findings.push("Excessive hyphens suggest a synthetic phishing domain.");
    }

    // Brand impersonation
    highRiskBrands.forEach(brand => {
        if (host.includes(brand)) {
            risk += 50;
            findings.push(`Brand impersonation detected: '${brand}'.`);
        }
    });

    // Phishing keyword clusters
    phishingClusters.forEach(cluster => {
        let hits = cluster.filter(word => lower.includes(word));
        if (hits.length >= 2) {
            risk += 50;
            findings.push(`Phishing keyword cluster detected: ${hits.join(" + ")}`);
        }
    });

    // Suspicious phishing words
    const phishingWords = [
        "login","verify","secure","update","alert","confirm",
        "required","locked","restore","appeal","payment",
        "billing","review","suspended","disabled"
    ];
    phishingWords.forEach(w => {
        if (host.includes(w)) {
            risk += 25;
            findings.push(`Phishing-related term detected: '${w}'.`);
        }
    });

    // Numeric tokens
    if (/[0-9]{3,}/.test(host)) {
        risk += 25;
        findings.push("Suspicious numeric token detected.");
    }

    // Delivery scam detection
    const deliveryWords = ["package","delivery","fedex","usps","ups","dhl","held","action-required","fee","confirm-details"];
    deliveryWords.forEach(w => {
        if (lower.includes(w)) {
            risk += 40;
            findings.push(`Delivery-scam pattern detected: '${w}'.`);
        }
    });

    // Encoded redirect
    if (looksEncoded(lower.split("=").pop())) {
        risk += 40;
        findings.push("Encoded redirect detected.");
    }

    // Homoglyph detection
    if (hasHomoglyphs(url)) {
        risk += 40;
        findings.push("Foreign homoglyph characters detected.");
    }

    // Typosquatting numbers
    const numberMaps = [
        { bad: "0", good: "o" }, { bad: "1", good: "l" },
        { bad: "3", good: "e" }, { bad: "5", good: "s" },
        { bad: "7", good: "t" }
    ];
    numberMaps.forEach(s => {
        if (host.includes(s.bad)) {
            risk += 45;
            findings.push(`Typosquatting substitution: '${s.bad}' for '${s.good}'.`);
        }
    });

    // Levenshtein brand similarity
    ["paypal","google","amazon","apple","facebook","netflix","chase","microsoft"].forEach(b => {
        const dist = levenshtein(host, b);
        if (dist <= 2 && !host.endsWith(`${b}.com`)) {
            risk += 50;
            findings.push(`Domain resembles '${b}' ‚Äî impersonation likely.`);
        }
    });

    // Long URL
    if (url.length > 80) {
        risk += 20;
        findings.push("URL is unusually long.");
    }

    // Excessive subdomains
    if ((host.match(/\./g) || []).length > 3) {
        risk += 25;
        findings.push("Too many subdomains ‚Äî common in phishing URLs.");
    }

    // Scoring
    const score = Math.min(100, risk);
    const safePercent = Math.max(0, 100 - score);

    let verdict = "SAFE";
    if (safePercent < 80) verdict = "SUSPICIOUS";
    if (safePercent < 50) verdict = "UNSAFE";

    return { score, safePercent, verdict, findings };
}

/* ----------------------------
   Scan Handler + Animation
----------------------------- */

document.getElementById("urlForm").addEventListener("submit", function (event) {
    event.preventDefault();

    const input = document.getElementById("urlInput").value;
    const box = document.getElementById("resultBox");

    // Scanning animation
    box.innerHTML = "<p>üîç Scanning URL</p>";
    let dots = 0;
    const interval = setInterval(() => {
        dots = (dots + 1) % 4;
        box.innerHTML = `<p>üîç Scanning${'.'.repeat(dots)}</p>`;
    }, 200);

    setTimeout(() => {
        clearInterval(interval);

        const result = analyzeURL(input);

        const emoji =
            result.verdict === "SAFE" ? "‚úÖ" :
            result.verdict === "SUSPICIOUS" ? "‚ö†Ô∏è" :
            "‚ùå";

        const list = result.findings.map(i => `<li>${i}</li>`).join("");

        box.innerHTML = `
            <p><strong>Status:</strong> ${emoji} ${result.verdict}</p>

            <div style="margin-top:12px;">
                <div style="width:100%;height:16px;background:#ddd;border-radius:10px;overflow:hidden;">
                    <div id="meterBar"
                        style="width:0%;height:100%;background:red;transition:width 1.2s, background 1s"></div>
                </div>
                <p><strong>Safety Score:</strong> ${result.safePercent}%</p>
            </div>

            <p><strong>Reasons:</strong></p>
            <ul>${list}</ul>
        `;

        const bar = document.getElementById("meterBar");

        setTimeout(() => {
            bar.style.width = result.safePercent + "%";
            bar.style.background =
                result.safePercent >= 80 ? "#2ecc71" :
                result.safePercent >= 50 ? "#f1c40f" :
                "#e74c3c";
        }, 50);

    }, 900);
});

</script>

</body>
</html>
